# Docker
# Build a Docker image
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  tag: '$(Build.BuildId)'
  TEST_RESULTS_DIR: 'TestResults'
  REPORT_FILE: 'report.html'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.11'
    addToPath: true

- task: Bash@3
  displayName: 'Install Docker and Docker Compose'
  inputs:
    targetType: 'inline'
    script: |
      docker compose down --volumes --remove-orphans || true
      docker compose build
      docker compose run --rm python-playwright-tests

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: 'TestResults'
    artifactName: 'TestReport'

- script: |
    echo "## ðŸ§ª Pytest Report" > summary.md
    echo "Click to download: [report.html](./TestReport/report.html)" >> summary.md
  displayName: 'Create markdown summary'

- task: PublishPipelineArtifact@1
  inputs:
    targetPath: 'summary.md'
    artifactName: 'TestReportSummary'

